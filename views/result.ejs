<!DOCTYPE html>
<html>
<head>
    <title>Deploy | Voomly</title>
</head>
<body>
    <h1>Detected Stack for:</h1>
    <p><%= repo %></p>
    <h2>â†’ <%= stack %></h2>

    <% if (stack === 'React') { %>
        <% if (!startLogs) { %>
            <!-- Show Deploy button if not started yet -->
        <form action="/deploy" method="post">
    <input type="hidden" name="repo" value="<%= repo %>">
    <input type="hidden" name="stack" value="<%= stack %>">
    <input type="hidden" name="port" value="<%= port %>">
    <input type="text" name="subdomain" placeholder="Enter subdomain" required>
    <button type="submit">ğŸš€ Deploy This App</button>
</form>

        <% } %>
    <% } else { %>
        <p>Deployment not supported for this stack yet.</p>
    <% } %>

    <% if (startLogs) { %>
        <h1>ğŸš€ Deployment Logs</h1>
        <h1>Repo: <%= repo %></h1>
        <h1>Stack: <%= stack %></h1>
        <a href="https://<%= subdomain %>.voomly.xyz" target="_blank">https://<%= subdomain %>.voomly.xyz</a>
        <pre id="logs">Streaming logs...
</pre>

        <script>
           const eventSource = new EventSource('/deploy-stream?repo=<%= encodedRepo %>&subdomainSafe=<%= subdomain %>');
            eventSource.onmessage = (e) => {
                document.getElementById('logs').textContent += e.data + "\n";
            };
            eventSource.onerror = () => {
                eventSource.close();
                document.getElementById('logs').textContent += '\nâŒ Connection closed.';
            };
        </script>
    <% } %>

    <br><a href="/">Check another repo</a>
</body>
</html>
